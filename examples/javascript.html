<html>
    <head>
        <title>Apisearch Javascript example</title>
        <script src="../dist/apisearch.js"></script>
    </head>
    <body>
        <!-- Content -->
        <label for="search">Search something:</label>
        <input type="text" value="" id="search"/>
        <div id="result"></div>
        <!-- /Content -->

        <!-- Underscore templating -->
        <script type="text/template" id="template">
            <b><%= total_hits %></b><br>
            <% if (items.length !== 0) { %>
                <% items.forEach(function(item) { %>
                    <div>
                        <b><%= item.metadata.author_name %></b>
                        <div><%= item.metadata.content %></div><br>
                    </div>
                <% }) %>
            <% } else { %>
                <div>No results found.</div>
            <% } %>
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <!-- /Underscore templating -->

        <!-- Apisearch -->
        <script>
            var searchInput = document.getElementById('search'),
                resultBlock = document.getElementById('result'),
                compiled = _.template(document.getElementById('template').innerHTML)
            ;

            // 1. Create the client
            let api = apisearch('sandbox_comments_secret');
            let query;

            searchInput.addEventListener('keyup', function (e) {
                // 2.- compose query
                query = api.query
                    .createLocated(
                        api.createObject.coordinate(1.2324, 1.1232),
                        e.target.value
                    )
                    .promoteUUID(
                        api.createObject.uuid('some_type', 'some_uuid')
                    )
                    .filterUniverseByLocation(
                        api.createObject.polygon(
                            api.createObject.coordinate(1.32, 1.32),
                            api.createObject.coordinate(1.35, 1.36),
                            api.createObject.coordinate(1.40, 1.38)
                        )
                    )
                    .enableHighlights()
                ;
                console.log(query, api)

                // 3.- Execute search
                api.search(query, function (result, error) {
                    // Handle error
                    if (error) {
                        console.log(error)
                        return;
                    }

                    // Render result
                    resultBlock.innerHTML = compiled({
                        total_hits: result.total_hits,
                        items: result.items || []
                    });

                    // Log
                    console.log(result);
                });
            });
        </script>
        <!-- /Apisearch -->
    </body>
</html>