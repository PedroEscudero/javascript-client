<html>
    <head>
        <title>Apisearch Javascript example</title>
        <script src="../dist/apisearch.min.js"></script>
    </head>
    <body>
        <!-- Content -->
        <label for="search">Search something:</label>
        <input type="text" value="" id="search"/>
        <div id="result"></div>
        <!-- /Content -->

        <!-- Underscore templating -->
        <script type="text/template" id="template">
            <b><%= total_hits %></b><br>
            <% if (items.length !== 0) { %>
                <% items.forEach(function(item) { %>
                    <div>
                        <img src="<%= item.metadata.img %>" width="50px" alt="<%= item.metadata.title %>" />
                        <b><%= item.metadata.title %></b>
                        <br /><br />
                    </div>
                <% }) %>
            <% } else { %>
                <div>No results found.</div>
            <% } %>
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <!-- /Underscore templating -->

        <!-- Apisearch -->
        <script>
            let searchInput = document.getElementById('search'),
                resultBlock = document.getElementById('result'),
                compiled = _.template(document.getElementById('template').innerHTML)
            ;

            // 1. Create the client
            let api = apisearch('music', '1cc7a3e0-bda5-11e7-abc4-cec278b6b50a', {
                endpoint: 'http://search.puntmig.net',
                cache: true
            });
            let query;

            searchInput.addEventListener('keyup', function (e) {
                // 2.- compose query
                query = api.query
                    .create(e.target.value)
                    .enableHighlights()
                ;

                // 3.- Execute search
                api.search(query, function (result, error) {
                    // Handle error
                    if (error) {
                        console.log(error);
                        return;
                    }

                    // Render result
                    resultBlock.innerHTML = compiled({
                        total_hits: result.total_hits,
                        items: result.items || []
                    });
                });
            });
        </script>
        <!-- /Apisearch -->
    </body>
</html>